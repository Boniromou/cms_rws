<%= bread_crumb("glyphicon glyphicon-user",t("tree_panel.player_management"),t("tree_panel.create_player")) %>

<section class='smart-form'>
  <%= form_for @player, :remote => true, html: {autocomplete: :off } do |f| %>
    <fieldset style='padding: 1px;'>
      <div class='row' style='padding-bottom: 10px;'>
        <div class='col col-2'>
          <label class='input'>
            <%= f.label :card_id, t("general.card_id") %>:
          </label>
        </div>
        <div class='col col-3'>
          <label class='input'>
            <%= f.text_field :card_id, autofocus: true, pattern: '^\d+$', oninput: 'validateNumberOnlyAndMaxLength($(this), value, CARD_ID_LENGTH_LIMIT)' %>
          </label>
        </div>
        <div class='col col-3'>
          <label class='invisible_error'>
            <%= t("create_player.card_id_blank_error") %>
          </label>
        </div>
      </div>
      <div class='row' style='padding-bottom: 10px;'>
        <div class='col col-2'>
          <label class='input'>
            <%= f.label :member_id, t("general.member_id") %>:
          </label>
        </div>
        <div class='col col-3'>
          <label class='input'>
            <%= f.text_field :member_id, pattern: '^\d+$', oninput: 'validateNumberOnlyAndMaxLength($(this), value, MEMBER_ID_LENGTH_LIMIT)' %>
          </label>
        </div>
        <div class='col col-3'>
          <label class='invisible_error'>
            <%= t("create_player.member_id_blank_error") %>
          </label>
        </div>
      </div>
      <div class='row' style='padding-bottom: 10px;'>
        <div class='col col-2'>
          <label class='input'>
            <%= f.label :name, t("general.name") %>:
          </label>
        </div>
        <div class='col col-3'>
          <label class='input'>
            <%= f.text_field :player_name %>
          </label>
        </div>
        <div class='col col-3'>
          <label class='invisible_error'>
            <%= t("create_player.name_blank_error") %>
          </label>
        </div>
      </div>
      <div class='row'>
        <div class='col col-5'>
          <footer>
            <%= f.submit t("button.create"), class: 'btn btn-primary pull-right', id: 'create_player_submit' %>
          </footer>
        </div>
      <div>
    </fieldset>
  <% end %>
</section>

<%= javascript_include_tag "validate.input.js" %>

<script>
  $(document).ready(function() {
    $('input[autofocus="autofocus"]').focus();
  });

  function formValidated() {
    function validated(comp) {
      if ( comp.val() == "" )
        return false;
      else
        return true;
    }

    function targetLabel(index) {
      return $("form#new_player > fieldset > div.row:eq(" + index + ") > div.col:eq(2) label");
    }

    function showError(comp, index) {
      targetLabel(index).css('visibility', 'visible');
      comp.parent().addClass('state-error');
    }

    function hideError(comp, index) {
      targetLabel(index).css('visibility', 'hidden');
      comp.parent().removeClass('state-error');
    }

    var allValidated = true;
    var formComps = [$("form#new_player input#player_card_id"), $("form#new_player input#player_member_id"), $("form#new_player input#player_player_name")];

    for (var i = 0; i < 3; i++) {
      var comp = $(formComps[i]);

      if ( !validated(comp) ) {
        allValidated = false;

        showError(comp, i);
      }
      else {
        hideError(comp, i);
      }
    }

    return allValidated;
  }

  $('form#new_player input#create_player_submit').click(function(e) {
    e.preventDefault();

    if ( formValidated() ) {
      $("form#new_player").submit();
    }
  });
</script>
